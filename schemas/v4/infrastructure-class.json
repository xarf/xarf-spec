{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://xarf.org/schemas/v4/infrastructure-class.json",
  "title": "XARF v4 Infrastructure Class Schema",
  "description": "Schema for compromised systems, malware infections, and malicious infrastructure including bots, C2 servers, and compromised services",
  "allOf": [
    {
      "$ref": "xarf-core.json"
    },
    {
      "type": "object",
      "properties": {
        "class": {
          "const": "infrastructure"
        },
        "type": {
          "type": "string",
          "enum": [
            "bot",
            "compromised_server",
            "compromised_website",
            "compromised_account",
            "compromised_microsoft_exchange",
            "c2_server",
            "malicious_proxy",
            "malicious_dns",
            "mining_pool",
            "cve"
          ],
          "description": "Specific type of infrastructure abuse or compromise"
        },
        "evidence_source": {
          "type": "string",
          "enum": [
            "researcher_analysis",
            "automated_discovery",
            "traffic_analysis",
            "behavioral_analysis",
            "network_monitoring",
            "threat_intelligence",
            "honeypot",
            "sinkhole"
          ],
          "description": "Source of evidence for infrastructure compromise"
        },
        "malware_family": {
          "type": "string",
          "maxLength": 200,
          "description": "Malware family name or classification",
          "examples": [
            "conficker", "mirai", "emotet", "trickbot", "qbot",
            "cobalt_strike", "metasploit", "empire", "covenant"
          ]
        },
        "botnet_name": {
          "type": "string",
          "maxLength": 200,
          "description": "Name of the botnet this system belongs to",
          "examples": ["conficker", "gameover_zeus", "necurs", "sality"]
        },
        "bot_id": {
          "type": "string",
          "maxLength": 100,
          "description": "Unique identifier for this bot within the botnet",
          "examples": ["bot-123456", "victim_12345", "infected_host_abc"]
        },
        "c2_server": {
          "type": "string",
          "description": "Command and control server address (domain or IP)",
          "examples": [
            "evil-c2.example.com",
            "192.0.2.100",
            "c2-backup.malware.net"
          ]
        },
        "c2_port": {
          "type": "integer",
          "minimum": 1,
          "maximum": 65535,
          "description": "Port used for C2 communications",
          "examples": [80, 443, 8080, 9999]
        },
        "c2_protocol": {
          "type": "string",
          "enum": ["http", "https", "tcp", "udp", "dns", "irc", "p2p", "custom"],
          "description": "Protocol used for C2 communications"
        },
        "compromise_method": {
          "type": "string",
          "maxLength": 200,
          "description": "How the system was compromised",
          "examples": [
            "malware_infection",
            "credential_theft",
            "vulnerability_exploitation",
            "social_engineering",
            "supply_chain_attack",
            "insider_threat"
          ]
        },
        "infection_vector": {
          "type": "string",
          "maxLength": 200,
          "description": "Initial infection or compromise vector",
          "examples": [
            "email_attachment",
            "drive_by_download",
            "usb_autorun",
            "network_share",
            "software_vulnerability",
            "credential_stuffing"
          ]
        },
        "operating_system": {
          "type": "string",
          "maxLength": 100,
          "description": "Operating system of compromised system",
          "examples": [
            "Windows 10", "Windows Server 2019", "Ubuntu 20.04",
            "CentOS 7", "macOS", "Android", "iOS"
          ]
        },
        "system_architecture": {
          "type": "string",
          "enum": ["x86", "x64", "arm", "arm64", "mips", "unknown"],
          "description": "System architecture of compromised system"
        },
        "first_seen": {
          "type": "string",
          "format": "date-time",
          "description": "When compromise was first observed"
        },
        "last_seen": {
          "type": "string",
          "format": "date-time",
          "description": "When compromise activity was last observed"
        },
        "activity_indicators": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "c2_communication",
              "data_exfiltration",
              "lateral_movement",
              "persistence",
              "privilege_escalation",
              "defense_evasion",
              "credential_dumping",
              "keylogging",
              "screen_capture",
              "cryptocurrency_mining",
              "ddos_participation",
              "spam_distribution",
              "proxy_service"
            ]
          },
          "description": "Observed malicious activities",
          "uniqueItems": true,
          "maxItems": 20
        },
        "communication_patterns": {
          "type": "object",
          "properties": {
            "beacon_interval": {
              "type": "integer",
              "minimum": 0,
              "description": "C2 beacon interval in seconds"
            },
            "data_volume_mb": {
              "type": "number",
              "minimum": 0,
              "description": "Volume of data transferred in MB"
            },
            "connection_frequency": {
              "type": "string",
              "enum": ["continuous", "periodic", "on_demand", "irregular"],
              "description": "Pattern of C2 connections"
            },
            "encryption_used": {
              "type": "boolean",
              "description": "Whether C2 communications are encrypted"
            }
          },
          "description": "Patterns of malicious communications",
          "additionalProperties": false
        },
        "services_affected": {
          "type": "array",
          "items": {
            "type": "string",
            "maxLength": 100
          },
          "description": "Services or applications affected by the compromise",
          "examples": [
            ["web_server", "database", "email_service", "dns_server"]
          ],
          "maxItems": 20
        },
        "data_at_risk": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "personal_information",
              "financial_data",
              "healthcare_records",
              "intellectual_property",
              "credentials", 
              "system_information",
              "network_topology",
              "business_documents",
              "customer_data",
              "payment_information"
            ]
          },
          "description": "Types of data potentially at risk",
          "uniqueItems": true,
          "maxItems": 15
        },
        "remediation_status": {
          "type": "string",
          "enum": [
            "not_started",
            "in_progress", 
            "partially_remediated",
            "fully_remediated",
            "verification_pending",
            "monitoring"
          ],
          "description": "Status of remediation efforts"
        },
        "remediation_actions": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "malware_removal",
              "system_rebuild",
              "password_reset",
              "patch_installation",
              "network_isolation",
              "service_restart",
              "configuration_hardening",
              "monitoring_deployment",
              "user_notification",
              "forensic_analysis"
            ]
          },
          "description": "Remediation actions taken or recommended",
          "uniqueItems": true,
          "maxItems": 15
        },
        "severity_assessment": {
          "type": "object",
          "properties": {
            "impact_level": {
              "type": "string",
              "enum": ["low", "medium", "high", "critical"],
              "description": "Overall impact level of the compromise"
            },
            "data_sensitivity": {
              "type": "string",
              "enum": ["public", "internal", "confidential", "restricted"],
              "description": "Sensitivity level of data at risk"
            },
            "system_criticality": {
              "type": "string",
              "enum": ["low", "medium", "high", "critical"],
              "description": "Criticality of the compromised system"
            },
            "business_impact": {
              "type": "string",
              "enum": ["none", "minimal", "moderate", "significant", "severe"],
              "description": "Impact on business operations"
            }
          },
          "description": "Assessment of compromise severity",
          "additionalProperties": false
        },
        "persistence_mechanisms": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "registry_modification",
              "startup_folder",
              "scheduled_task",
              "service_installation",
              "dll_hijacking",
              "boot_sector_modification",
              "wmi_persistence",
              "account_creation",
              "privilege_escalation",
              "rootkit_installation"
            ]
          },
          "description": "Methods used to maintain persistence on the system",
          "uniqueItems": true,
          "maxItems": 10
        }
      }
    }
  ],
  "examples": [
    {
      "xarf_version": "4.0.0",
      "report_id": "456789ab-cdef-1234-5678-90abcdef1234",
      "timestamp": "2024-01-15T08:15:45Z",
      "reporter": {
        "org": "Botnet Research Group",
        "contact": "research@botnetwatch.org",
        "type": "automated"
      },
      "source_identifier": "192.0.2.200",
      "class": "infrastructure",
      "type": "bot",
      "malware_family": "conficker",
      "botnet_name": "conficker",
      "bot_id": "bot-123456",
      "c2_server": "evil-c2.example.com",
      "c2_port": 8443,
      "c2_protocol": "https",
      "first_seen": "2024-01-10T12:30:00Z",
      "last_seen": "2024-01-15T08:00:00Z",
      "evidence_source": "traffic_analysis",
      "activity_indicators": ["c2_communication", "spam_distribution"],
      "evidence": [
        {
          "content_type": "text/plain",
          "description": "C2 communication logs showing bot activity",
          "payload": "MjAyNC0wMS0xNVQwODowMDowMFogQ29ubmVjdGlvbiB0byBldmlsLWMyLmV4YW1wbGUuY29tOjg0NDM="
        }
      ],
      "tags": ["botnet:conficker", "infection:active"],
      "confidence": 0.88
    }
  ]
}