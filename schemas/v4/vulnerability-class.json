{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://xarf.org/schemas/v4/vulnerability-class.json",
  "title": "XARF v4 Vulnerability Class Schema", 
  "description": "Schema for security vulnerabilities, misconfigurations, and security disclosures requiring system patching or hardening",
  "allOf": [
    {
      "$ref": "xarf-core.json"
    },
    {
      "type": "object",
      "properties": {
        "class": {
          "const": "vulnerability"
        },
        "type": {
          "type": "string",
          "enum": [
            "open",
            "cve",
            "outdated_dnssec",
            "ssl_freak",
            "ssl_poodle", 
            "ssl_heartbleed",
            "malicious_activity",
            "misconfiguration",
            "weak_credentials",
            "information_disclosure",
            "privilege_escalation",
            "code_injection",
            "authentication_bypass"
          ],
          "description": "Specific type of vulnerability or security issue"
        },
        "evidence_source": {
          "type": "string",
          "enum": [
            "vulnerability_scan",
            "researcher_analysis",
            "automated_discovery",
            "penetration_testing",
            "security_audit",
            "threat_intelligence",
            "responsible_disclosure"
          ],
          "description": "Source of vulnerability evidence"
        },
        "service": {
          "type": "string",
          "maxLength": 200,
          "description": "Vulnerable service or application name (REQUIRED)",
          "examples": [
            "Apache HTTP Server",
            "OpenSSL",
            "Windows SMB",
            "SSH Server",
            "MySQL Database",
            "WordPress",
            "Nginx"
          ]
        },
        "service_version": {
          "type": "string",
          "maxLength": 100,
          "description": "Version of the vulnerable service",
          "examples": ["2.4.41", "1.1.1a", "OpenSSH_7.4", "5.7.33"]
        },
        "service_port": {
          "type": "integer",
          "minimum": 1,
          "maximum": 65535,
          "description": "Port number where vulnerable service is running",
          "examples": [80, 443, 22, 3389, 21, 23, 25]
        },
        "cve_id": {
          "type": "string",
          "pattern": "^CVE-[0-9]{4}-[0-9]+$",
          "description": "CVE identifier if vulnerability has assigned CVE",
          "examples": ["CVE-2021-44228", "CVE-2014-0160", "CVE-2017-5638"]
        },
        "cve_ids": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^CVE-[0-9]{4}-[0-9]+$"
          },
          "description": "Multiple CVE identifiers if vulnerability involves multiple CVEs",
          "maxItems": 10,
          "uniqueItems": true
        },
        "cvss_score": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 10.0,
          "description": "CVSS vulnerability score (0.0-10.0)"
        },
        "cvss_vector": {
          "type": "string",
          "pattern": "^CVSS:3\\.[01]/.*",
          "description": "CVSS v3 vector string",
          "examples": [
            "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H",
            "CVSS:3.0/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H"
          ]
        },
        "cvss_version": {
          "type": "string",
          "enum": ["2.0", "3.0", "3.1"],
          "description": "CVSS version used for scoring"
        },
        "risk_level": {
          "type": "string",
          "enum": ["info", "low", "medium", "high", "critical"],
          "description": "Risk assessment level based on exploitability and impact"
        },
        "severity": {
          "type": "string",
          "enum": ["informational", "low", "medium", "high", "critical"],
          "description": "Severity classification of the vulnerability"
        },
        "exploitability": {
          "type": "string",
          "enum": ["theoretical", "poc_available", "functional", "weaponized"],
          "description": "Level of exploit availability and maturity"
        },
        "patch_available": {
          "type": "boolean",
          "description": "Whether a patch or fix is available"
        },
        "patch_version": {
          "type": "string",
          "maxLength": 100,
          "description": "Version that fixes the vulnerability",
          "examples": ["2.4.46", "1.1.1k", "OpenSSH_8.0", "5.7.35"]
        },
        "patch_url": {
          "type": "string",
          "format": "uri",
          "description": "URL to patch, security advisory, or fix information"
        },
        "vendor_advisory": {
          "type": "string",
          "format": "uri",
          "description": "URL to vendor security advisory"
        },
        "workaround_available": {
          "type": "boolean",
          "description": "Whether workarounds are available"
        },
        "workaround_description": {
          "type": "string",
          "maxLength": 1000,
          "description": "Description of available workarounds"
        },
        "discovery_date": {
          "type": "string",
          "format": "date-time",
          "description": "When vulnerability was discovered"
        },
        "disclosure_date": {
          "type": "string",
          "format": "date-time",
          "description": "When vulnerability was publicly disclosed"
        },
        "first_seen": {
          "type": "string",
          "format": "date-time",
          "description": "When vulnerable service was first observed"
        },
        "last_verified": {
          "type": "string",
          "format": "date-time",
          "description": "When vulnerability was last verified to exist"
        },
        "attack_vector": {
          "type": "string",
          "enum": ["network", "adjacent", "local", "physical"],
          "description": "Attack vector required to exploit vulnerability"
        },
        "attack_complexity": {
          "type": "string",
          "enum": ["low", "high"],
          "description": "Complexity required to exploit vulnerability"
        },
        "privileges_required": {
          "type": "string",
          "enum": ["none", "low", "high"],
          "description": "Privilege level required to exploit vulnerability"
        },
        "user_interaction": {
          "type": "string",
          "enum": ["none", "required"],
          "description": "Whether user interaction is required for exploitation"
        },
        "impact_assessment": {
          "type": "object",
          "properties": {
            "confidentiality": {
              "type": "string",
              "enum": ["none", "low", "high"],
              "description": "Impact on data confidentiality"
            },
            "integrity": {
              "type": "string", 
              "enum": ["none", "low", "high"],
              "description": "Impact on data integrity"
            },
            "availability": {
              "type": "string",
              "enum": ["none", "low", "high"],
              "description": "Impact on system availability"
            },
            "scope": {
              "type": "string",
              "enum": ["unchanged", "changed"],
              "description": "Whether vulnerability can affect other systems"
            }
          },
          "description": "CIA triad impact assessment",
          "additionalProperties": false
        },
        "affected_systems": {
          "type": "array",
          "items": {
            "type": "string",
            "maxLength": 200
          },
          "description": "List of affected systems or platforms",
          "examples": [
            ["Windows Server 2019", "Ubuntu 18.04", "CentOS 7"]
          ],
          "maxItems": 20
        },
        "vulnerable_configurations": {
          "type": "array",
          "items": {
            "type": "string",
            "maxLength": 300
          },
          "description": "Specific configurations that are vulnerable",
          "maxItems": 10
        },
        "exploitation_indicators": {
          "type": "object",
          "properties": {
            "in_the_wild": {
              "type": "boolean",
              "description": "Whether exploitation has been observed in the wild"
            },
            "exploit_code_maturity": {
              "type": "string",
              "enum": ["unproven", "proof_of_concept", "functional", "high"],
              "description": "Maturity level of available exploit code"
            },
            "exploit_availability": {
              "type": "string",
              "enum": ["none", "research", "public", "commercial"],
              "description": "Availability of exploit tools"
            },
            "targeted_attacks": {
              "type": "boolean",
              "description": "Whether vulnerability is being used in targeted attacks"
            }
          },
          "description": "Information about vulnerability exploitation",
          "additionalProperties": false
        },
        "references": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "url": {
                "type": "string",
                "format": "uri"
              },
              "type": {
                "type": "string",
                "enum": ["advisory", "exploit", "patch", "analysis", "news", "vendor"]
              },
              "description": {
                "type": "string",
                "maxLength": 200
              }
            },
            "required": ["url", "type"],
            "additionalProperties": false
          },
          "description": "References to vulnerability information",
          "maxItems": 20
        },
        "remediation_priority": {
          "type": "string",
          "enum": ["low", "medium", "high", "critical", "emergency"],
          "description": "Recommended priority for remediation"
        },
        "remediation_timeline": {
          "type": "string",
          "enum": ["immediate", "24_hours", "72_hours", "1_week", "1_month", "planned"],
          "description": "Recommended timeline for remediation"
        },
        "business_impact": {
          "type": "string",
          "enum": ["none", "minimal", "moderate", "significant", "severe"],
          "description": "Potential business impact if exploited"
        }
      },
      "required": ["service"]
    }
  ],
  "examples": [
    {
      "xarf_version": "4.0.0",
      "report_id": "vuln5678-90ab-cdef-1234-567890abcdef",
      "timestamp": "2024-01-15T09:20:30Z",
      "reporter": {
        "org": "Vulnerability Scanner Service",
        "contact": "security@vulnscan.org",
        "type": "automated"
      },
      "source_identifier": "203.0.113.75",
      "class": "vulnerability",
      "type": "cve",
      "service": "Apache HTTP Server",
      "service_version": "2.4.41",
      "service_port": 80,
      "cve_id": "CVE-2021-41773",
      "cvss_score": 7.5,
      "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N",
      "risk_level": "high",
      "severity": "high",
      "patch_available": true,
      "patch_version": "2.4.51",
      "evidence_source": "vulnerability_scan",
      "evidence": [
        {
          "content_type": "text/plain",
          "description": "Vulnerability scan results showing Apache version",
          "payload": "QXBhY2hlIEhUVFAgU2VydmVyIDIuNC40MSBkZXRlY3RlZCB3aXRoIENWRS0yMDIxLTQxNzcz"
        }
      ],
      "tags": ["cve:CVE-2021-41773", "severity:high", "service:apache"]
    }
  ]
}