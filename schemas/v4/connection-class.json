{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://xarf.org/schemas/v4/connection-class.json",
  "title": "XARF v4 Connection Class Schema",
  "description": "Schema for network-level attacks and unauthorized connection attempts including login attacks, DDoS, and port scanning",
  "allOf": [
    {
      "$ref": "xarf-core.json"
    },
    {
      "type": "object",
      "properties": {
        "class": {
          "const": "connection"
        },
        "type": {
          "type": "string",
          "enum": [
            "login_attack",
            "port_scan", 
            "ddos",
            "ddos_amplification",
            "auth_failure",
            "ip_spoof",
            "connection_flood",
            "protocol_abuse"
          ],
          "description": "Specific type of connection-based attack"
        },
        "evidence_source": {
          "type": "string",
          "enum": [
            "honeypot",
            "firewall_logs",
            "ids_detection",
            "flow_analysis",
            "server_logs",
            "network_monitoring",
            "intrusion_detection"
          ],
          "description": "Source of evidence for connection abuse"
        },
        "destination_ip": {
          "type": "string",
          "anyOf": [
            {"format": "ipv4"},
            {"format": "ipv6"}
          ],
          "description": "Target IP address of the attack (REQUIRED)",
          "examples": ["203.0.113.100", "2001:db8::100"]
        },
        "destination_port": {
          "type": "integer",
          "minimum": 1,
          "maximum": 65535,
          "description": "Target port number",
          "examples": [22, 80, 443, 3389, 1433]
        },
        "protocol": {
          "type": "string",
          "enum": ["tcp", "udp", "icmp", "sctp"],
          "description": "Network protocol used in the attack (REQUIRED)"
        },
        "attempt_count": {
          "type": "integer",
          "minimum": 1,
          "description": "Number of connection or authentication attempts",
          "examples": [50, 1000, 25000]
        },
        "unique_targets": {
          "type": "integer",
          "minimum": 1,
          "description": "Number of unique target addresses (for scanning attacks)"
        },
        "duration_seconds": {
          "type": "integer",
          "minimum": 1,
          "description": "Duration of the attack in seconds"
        },
        "first_seen": {
          "type": "string",
          "format": "date-time",
          "description": "When attack activity was first observed"
        },
        "last_seen": {
          "type": "string",
          "format": "date-time", 
          "description": "When attack activity was last observed"
        },
        "threshold_exceeded": {
          "type": "string",
          "format": "date-time",
          "description": "When detection threshold was exceeded to trigger this report"
        },
        "attack_vector": {
          "type": "string",
          "maxLength": 200,
          "description": "Specific attack method or technique used",
          "examples": [
            "brute_force_ssh",
            "syn_flood", 
            "udp_flood",
            "icmp_flood",
            "tcp_connect_scan",
            "credential_stuffing",
            "dictionary_attack"
          ]
        },
        "service_targeted": {
          "type": "string",
          "maxLength": 100,
          "description": "Service or application being targeted",
          "examples": ["ssh", "rdp", "web", "dns", "mail", "database", "ftp"]
        },
        "packet_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of packets sent during attack"
        },
        "byte_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of bytes transferred during attack"
        },
        "peak_pps": {
          "type": "integer",
          "minimum": 0,
          "description": "Peak packets per second during attack"
        },
        "peak_bps": {
          "type": "integer",
          "minimum": 0,
          "description": "Peak bytes per second during attack"
        },
        "amplification_factor": {
          "type": "number",
          "minimum": 1.0,
          "description": "Amplification factor for reflection attacks",
          "examples": [2.5, 10.0, 100.0]
        },
        "botnet_participation": {
          "type": "boolean",
          "description": "Whether source appears to be part of botnet"
        },
        "geographic_distribution": {
          "type": "object",
          "properties": {
            "countries": {
              "type": "array",
              "items": {
                "type": "string",
                "pattern": "^[A-Z]{2}$"
              },
              "description": "ISO 3166-1 alpha-2 country codes where attack originated"
            },
            "asns": {
              "type": "array",
              "items": {
                "type": "integer",
                "minimum": 1
              },
              "description": "Autonomous System Numbers involved in attack"
            }
          },
          "description": "Geographic and network distribution of attack sources",
          "additionalProperties": false
        },
        "mitigation_applied": {
          "type": "boolean",
          "description": "Whether mitigation measures were applied"
        },
        "mitigation_details": {
          "type": "string",
          "maxLength": 500,
          "description": "Details about mitigation measures applied",
          "examples": [
            "Traffic blocked at firewall", 
            "Rate limiting applied",
            "Source IP blacklisted"
          ]
        },
        "impact_assessment": {
          "type": "object",
          "properties": {
            "service_degradation": {
              "type": "boolean",
              "description": "Whether service performance was affected"
            },
            "service_unavailable": {
              "type": "boolean",
              "description": "Whether service became unavailable"
            },
            "resource_exhaustion": {
              "type": "boolean",
              "description": "Whether system resources were exhausted"
            },
            "downtime_seconds": {
              "type": "integer",
              "minimum": 0,
              "description": "Duration of service downtime in seconds"
            }
          },
          "description": "Assessment of attack impact on targeted systems",
          "additionalProperties": false
        }
      },
      "required": ["destination_ip", "protocol"],
      "if": {
        "properties": {
          "type": {
            "enum": ["login_attack", "auth_failure"]
          }
        }
      },
      "then": {
        "properties": {
          "service_targeted": {
            "type": "string"
          },
          "attempt_count": {
            "type": "integer",
            "minimum": 1
          }
        },
        "required": ["service_targeted", "attempt_count"]
      }
    }
  ],
  "examples": [
    {
      "xarf_version": "4.0.0",
      "report_id": "x4y5z6a7-b8c9-0123-xy45-67890wx12345",
      "timestamp": "2024-01-15T16:55:42Z",
      "reporter": {
        "org": "DDoS Protection Service",
        "contact": "ddos@protectionservice.net",
        "type": "automated"
      },
      "source_identifier": "192.0.2.155",
      "class": "connection",
      "type": "ddos",
      "destination_ip": "203.0.113.100",
      "destination_port": 80,
      "protocol": "tcp",
      "attack_vector": "syn_flood",
      "peak_pps": 250000,
      "peak_bps": 1200000000,
      "duration_seconds": 2700,
      "packet_count": 11250000,
      "byte_count": 3240000000,
      "botnet_participation": true,
      "mitigation_applied": true,
      "evidence_source": "flow_analysis",
      "evidence": [
        {
          "content_type": "text/plain",
          "description": "DDoS attack flow analysis and statistics",
          "payload": "RERvUyBhdHRhY2sgZGV0ZWN0ZWQ6IDI1MEsgcHBzLCAxLjJHYnBzLCA0NSBtaW51dGVz"
        }
      ],
      "tags": ["attack:syn_flood", "volume:high", "mitigation:applied"]
    }
  ]
}